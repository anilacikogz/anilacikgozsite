<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gelişmiş .io Oyunu</title>
    
    <style>
        /* Sayfanın tamamını kaplaması ve kenar boşluklarını sıfırlamak için */
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Kaydırma çubuklarını engelle */
            width: 100%;
            height: 100%;
            background-color: #111; /* Canvas arkasındaki boşluk rengi */
        }
        canvas {
            display: block; /* Canvas'ın etrafındaki istenmeyen boşlukları kaldırır */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- OYUN AYARLARI ---
        const foodCount = 150;
        const botCount = 10;
        const playerSpeed = 0.04; // Daha yumuşak ve yavaş hareket

        // --- CANVAS VE CONTEXT ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Canvas'ı tam ekran yap
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Pencere yeniden boyutlandırıldığında canvas'ı da ayarla
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // --- OYUN DEĞİŞKENLERİ ---
        let player;
        let foods = [];
        let bots = [];
        let score = 0;
        let highScore = localStorage.getItem('ioGameHighScore') || 0;
        let gameState = 'playing'; // 'playing' veya 'gameOver'
        let mouse = { x: canvas.width / 2, y: canvas.height / 2 };

        // Fare hareketlerini takip et
        canvas.addEventListener('mousemove', (event) => {
            mouse.x = event.clientX;
            mouse.y = event.clientY;
        });

        // Tıklama ile oyunu yeniden başlat
        canvas.addEventListener('click', () => {
            if (gameState === 'gameOver') {
                startGame();
            }
        });

        // --- YARDIMCI FONKSİYONLAR ---
        function getDistance(x1, y1, x2, y2) {
            const xDist = x2 - x1;
            const yDist = y2 - y1;
            return Math.sqrt(Math.pow(xDist, 2) + Math.pow(yDist, 2));
        }

        function getRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsl(${hue}, 80%, 60%)`; // Canlı ve güzel renkler için HSL kullan
        }
        
        // --- OLUŞTURMA FONKSİYONLARI ---

        // Oyuncu nesnesini oluşturan/sıfırlayan fonksiyon
        function createPlayer() {
            player = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: 20,
                color: 'hsl(200, 100%, 70%)',
                isPlayer: true
            };
        }

        // Yemleri oluşturan fonksiyon
        function createFoods() {
            foods = [];
            for (let i = 0; i < foodCount; i++) {
                foods.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: 7,
                    color: getRandomColor()
                });
            }
        }

        // Botları oluşturan fonksiyon
        function createBots() {
            bots = [];
            for (let i = 0; i < botCount; i++) {
                bots.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 15 + 10,
                    color: getRandomColor(),
                    speed: Math.random() * 0.01 + 0.005,
                    target: null // Botun hedeflediği yem
                });
            }
        }

        // --- ÇİZİM FONKSİYONLARI (TASARIM GÜZELLEŞTİRMELERİ) ---

        function drawBackground() {
            // Gradyan bir arkaplan oluştur
            const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width);
            gradient.addColorStop(0, '#2c3e50');
            gradient.addColorStop(1, '#1a252f');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawEntity(entity) {
            // Varlıklara (oyuncu, bot, yem) daha güzel bir görünüm verelim
            ctx.save(); // Mevcut çizim ayarlarını kaydet
            ctx.beginPath();
            ctx.arc(entity.x, entity.y, entity.radius, 0, Math.PI * 2, false);
            
            // Parlama efekti
            ctx.shadowColor = entity.color;
            ctx.shadowBlur = 15;

            ctx.fillStyle = entity.color;
            ctx.fill();
            ctx.closePath();
            
            // Kenarlık efekti
            ctx.beginPath();
            ctx.arc(entity.x, entity.y, entity.radius * 0.9, 0, Math.PI * 2, false);
            ctx.fillStyle = `rgba(255, 255, 255, 0.5)`;
            ctx.fill();
            ctx.closePath();
            
            ctx.restore(); // Kaydedilen ayarları geri yükle
        }

        function drawUI() {
            // Mevcut Skor
            ctx.font = '24px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'left';
            ctx.fillText(`Skor: ${score}`, 20, 40);

            // En Yüksek Skor
            ctx.textAlign = 'right';
            ctx.fillText(`En İyi: ${highScore}`, canvas.width - 20, 40);
        }
        
        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.font = '60px Arial';
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText('Oyun Bitti!', canvas.width / 2, canvas.height / 2 - 40);

            ctx.font = '30px Arial';
            ctx.fillText(`Skorunuz: ${score}`, canvas.width / 2, canvas.height / 2 + 20);

            ctx.font = '20px Arial';
            ctx.fillText('Tekrar Oynamak İçin Tıkla', canvas.width / 2, canvas.height / 2 + 70);
        }

        // --- GÜNCELLEME VE MANTIK FONKSİYONLARI ---

        function updatePlayer() {
            player.x += (mouse.x - player.x) * playerSpeed;
            player.y += (mouse.y - player.y) * playerSpeed;

            // Yem yeme kontrolü
            foods.forEach((food, index) => {
                const distance = getDistance(player.x, player.y, food.x, food.y);
                if (distance < player.radius) {
                    player.radius += 20 / player.radius; // Büyüdükçe büyüme hızı yavaşlar
                    score++;
                    foods.splice(index, 1);
                    foods.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: 7, color: getRandomColor() });
                }
            });
        }
        
        function updateBots() {
            bots.forEach(bot => {
                // Basit AI: En yakın yemi bul ve ona doğru git
                if (!bot.target || foods.indexOf(bot.target) === -1) {
                    let closestDist = Infinity;
                    foods.forEach(food => {
                        const dist = getDistance(bot.x, bot.y, food.x, food.y);
                        if (dist < closestDist) {
                            closestDist = dist;
                            bot.target = food;
                        }
                    });
                }
                
                if (bot.target) {
                    bot.x += (bot.target.x - bot.x) * bot.speed;
                    bot.y += (bot.target.y - bot.y) * bot.speed;
                }
                
                // Yem yeme kontrolü
                const distToTarget = getDistance(bot.x, bot.y, bot.target.x, bot.target.y);
                if (distToTarget < bot.radius) {
                    bot.radius += 20 / bot.radius;
                    const foodIndex = foods.indexOf(bot.target);
                    if (foodIndex !== -1) foods.splice(foodIndex, 1);
                    bot.target = null; // Yeni hedef bul
                    foods.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: 7, color: getRandomColor() });
                }
            });
        }
        
        function checkCollisions() {
            const allEntities = [player, ...bots];
            
            for (let i = 0; i < allEntities.length; i++) {
                for (let j = i + 1; j < allEntities.length; j++) {
                    const e1 = allEntities[i];
                    const e2 = allEntities[j];
                    
                    const dist = getDistance(e1.x, e1.y, e2.x, e2.y);
                    
                    if (dist < Math.max(e1.radius, e2.radius)) {
                        let bigger = e1.radius > e2.radius ? e1 : e2;
                        let smaller = e1.radius > e2.radius ? e2 : e1;
                        
                        // %10'dan daha büyükse yiyebilir (ani yemeleri engellemek için)
                        if (bigger.radius > smaller.radius * 1.1) {
                            bigger.radius += smaller.radius * 0.5 / bigger.radius;
                            
                            if (smaller.isPlayer) {
                                gameState = 'gameOver'; // Oyuncu yendi
                            } else {
                                // Yenen botu yeniden oluştur
                                const botIndex = bots.indexOf(smaller);
                                if (botIndex !== -1) {
                                    bots.splice(botIndex, 1);
                                    bots.push({x: Math.random() * canvas.width, y: Math.random() * canvas.height, radius: Math.random() * 15 + 10, color: getRandomColor(), speed: Math.random() * 0.01 + 0.005, target: null});
                                    if(bigger.isPlayer) score += 10;
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // --- ANA OYUN DÖNGÜSÜ ---
        function gameLoop() {
            if (gameState === 'playing') {
                updatePlayer();
                updateBots();
                checkCollisions();
            }

            // Çizim işlemleri her durumda yapılır
            drawBackground();
            foods.forEach(drawEntity);
            bots.forEach(drawEntity);
            if (player) drawEntity(player);
            drawUI();
            
            if (gameState === 'gameOver') {
                // En yüksek skoru güncelle
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('ioGameHighScore', highScore);
                }
                drawGameOver();
            }
            
            requestAnimationFrame(gameLoop);
        }

        // --- OYUNU BAŞLATMA ---
        function startGame() {
            createPlayer();
            createFoods();
            createBots();
            score = 0;
            gameState = 'playing';
        }
        
        startGame();
        gameLoop();
    </script>
</body>
</html>
